function enableFeatures(){$("span#delivery_add_address").click(function(){$("div#checkout_delivery_details").slideDown("slow");$(this).fadeTo(500,0)});$("button#save_new_billing").click(function(){$.fn.formOverlay.displayOverlay=null});$("input#create_address_mode").click(function(){$("div#payment_new_address").slideDown("slow");$(window).scrollTo($("fieldset#billing_create_new_address"),800)});$("input#select_address_mode").click(function(){$("div#payment_new_address").slideUp("slow");$(window).scrollTo($("fieldset#billing_select_existing_address"),800)});$("select#cardType").change(function(){$("fieldset#payment_fields .ignore").removeClass("ignore").parent("div").css("opacity",1);var a=$(this).val();if(a!=""){switch(a){case"DELTA":break;case"VISA":$("input#payment_card_issue_number").addClass("ignore").parent("div").removeClass("invalid").css("opacity",0.3);break;case"MASTERCARD":$("input#payment_card_issue_number").addClass("ignore").parent("div").removeClass("invalid").css("opacity",0.3);break;case"SOLO":break;case"JCB":break;case"SWITCH":break;case"AMEX":break}}});$("span#create_new_billing").click(function(){$("form#createNewDeliveryAddress").slideDown();$(window).scrollTo($("div#checkout"),800)})}function setupAddressAndPostcode(){if(($("#checkout_delivery_details").length>0&&$("div.first_customer_address").length<1&&$("select#postcode_address_id").length>0)||($("div#delivery_second_section:visible").length>0)){$(window).scrollTo($("fieldset.postcode_lookup"),800)}if($("form#createNewDeliveryAddress:visible").length>0){$(window).scrollTo($("fieldset.postcode_lookup"),800)}$("#no_postcode").click(function(){$(window).scrollTo($("fieldset.postcode_lookup"),800);$("#delivery_second_section").removeClass("jshide").show();$(this).parent().hide()});if($("div.updated_address").length>0){$(window).scrollTo($("div#checkout"),800)}$("#search_postcode_button").click(function(){postcodeAction(this,"Search")});$(".postcodeAddressSelect").change(function(){postcodeAction(this,"Fetch")});var a=$("#search_postcode");a.focus(function(){$(document).keydown(function(b){if(b.keyCode==13){$("#search_postcode_button").click()}})});a.blur(function(){$(window).unbind("keypress")});$("#use_this_billing").click(function(){var b="<p>"+$("div#delivery_first_section select#title").val()+" "+$("div#delivery_first_section input#first_name").val()+" "+$("div#delivery_first_section input#last_name").val()+"</p>";$("#delivery_second_section .element").each(function(){var c=$(this).find("input");var d=$(this).find("select");if(c.length>0&&c.val()){b+="<p>"+c.val()+"</p>"}if(d.length>0&&d.val()){b+="<p>"+d.val()+"</p>"}});if($("div#delivery_first_section input#telephone_number").val()){b+="<p>"+$("div#delivery_first_section input#telephone_number").val()+"</p>"}if($("div#delivery_first_section input#mobile_number").val()){b+="<p>"+$("div#delivery_first_section input#mobile_number").val()+"</p>"}$("#payment_new_address").prev("address").remove().end().before("<address>"+b+"</address>");$("#payment_new_address").slideUp("fast")})}function postcodeAction(a,c){var b=$(a).parents("form");if(b.attr("action")==="/pws/secure/ProcessPayment.ice"){b.attr("action","/pws/secure/CheckoutAddressAction.ice")}if(typeof $.fn.formOverlay.displayOverlay==="function"){$.fn.formOverlay.displayOverlay=null}$(".validate").addClass("ignore");$(a).parents("form").find("input[name='checkoutAddressMode']").val("postcode"+c).end().submit()}function setupPaymentOverlay(){if($("form#payment_information").html()){$("form#payment_information input").each(function(b){$(this).attr("autocomplete","off")});if($("body#fr").length!=0){var a='<div id="overlayCont"><h3 id="overlayAjaxLoader"><img id="paymentAjaxLoader" src="/pws/images/ajax-loader-payment.gif" alt="Chargement..." /></h3><h3 id="overlayHeading">Paiement en cours</h3><p class="overlayMessage">Nous vous remercions d\'avoir choisi Habitat.<br />Nous proc&eacute;dons actuellement au traitement de votre commande.</p><p class="overlayMessage">Cela peut prendre quelques minutes. Nous vous remercions donc de <strong>ne pas rafra&icirc;chir cette page avant la fin de cette op&eacute;ration.</strong></p><p class="overlayMessage">Vous serez ensuite dirig&eacute; vers une page de confirmation de votre commande.</p></div>'}if($("body#es").length!=0){var a='<div id="overlayCont"><h3 id="overlayHeading">Proceso del pago</h3><h3 id="overlayAjaxLoader"><img id="paymentAjaxLoader" src="/pws/images/ajax_loader.gif" alt="Loading..." /></h3></div>'}if($("body#de").length!=0){var a='<div id="overlayCont"><h3 id="overlayAjaxLoader"><img id="paymentAjaxLoader" src="/pws/images/ajax-loader-payment.gif" alt="Loading..." /></h3><h3 id="overlayHeading">Ihre Bestellung wird bearbeitet</h3><p class="overlayMessage">Vielen Dank f\u00FCr Ihren Einkauf bei Habitat. <br/>Wir bearbeiten momentan Ihre Bestellung.</p><p class="overlayMessage"><strong>Bitte aktualisieren Sie w\u00E4hrend dieser Bearbeitung Ihren Bildschirm nicht.</strong></p><p class="overlayMessage">Sie werden in K\u00FCrrze zu unserer Bestellbest\u00E4tigungsseite umgeleitet.</p></div>'}if($("body#en").length!=0){var a='<div id="overlayCont"><h3 id="overlayAjaxLoader"><img id="paymentAjaxLoader" src="/pws/images/ajax-loader-payment.gif" alt="Loading..." /></h3><h3 id="overlayHeading">Processing your order</h3><p class="overlayMessage">Thank you for shopping at Habitat. <br/>We are currently processing the details of your order.</p><p class="overlayMessage"><strong>Please do not refresh your screen while this is happening.</strong></p><p class="overlayMessage">You will shortly be directed to the order confirmation page.</p></div>'}$("form#payment_information").formOverlay({revealSpeed:1000,target:window,message:a,onFormSubmit:function(){return false;if($.browser.msie&&$.browser.version==="6.0"){$("select").css("visibility","hidden");var b=$("img#paymentAjaxLoader").attr("src");$("img#paymentAjaxLoader").attr("src",b)}}})}}function otherTitle(){function a(){if($("select#title").val()=="Other"){$("div.other_title_element").removeClass("hide").find("input").removeClass("ignore")}else{$("div.other_title_element").addClass("hide").find("input").addClass("ignore")}}$("select#title").change(function(){a()});a()}function submitDeliveryOptions(){$(".delivery-option").click(function(a){if($(a.target).hasClass("delivery_type")){$("#choose_shipping").submit()}});if($.browser.msie){$(".delivery-option").click(function(a){$(this).find("input").attr("checked","checked");$("#choose_shipping").submit()})}}function basketDeliveryTickboxes(){var a=0;$("#choose_shipping .delivery-option").each(function(){a++;var b=$(this).find("input.delivery_type");var c=$(this).find("label");$("<span>tickbox</span>").insertBefore(b);if(b.attr("checked")){$(this).find("label span").addClass("currentSelected")}b.hide()})}function assemblyBasket(){$(".addAssembly, .removeAssembly").bind("click",function(){window.location.href=this.href;return false});$("input.assemblyCheck").click(function(){if(this.checked){$(this).parent().children("a.addAssembly").trigger("click")}else{$(this).parent().children("a.removeAssembly").trigger("click")}})}function editAddressAction(){var a=$("#customer_address_id");a.change(function(){var c=$("#customer_address_id"),b=[$("#edit_address_link")],e,d=function(){var f;for(f=0;f<b.length;f++){b[f].attr("href",e+b[f].attr("data-location"))}};if(c.val()){e="/pws/secure/EditCheckoutAddress.ice?id="+c.val();if($("body").hasClass("ly_paymentdetails")){e=e+"&billingAddress=true"}d()}})}function hiddenSaveCardCheckbox(){var a=$('input[name="saveCard"]'),b=$('input[name="saveCardHidden"]');if(a.is(":checked")){b.disabled()}}$(document).ready(function(){enableFeatures();setupAddressAndPostcode();setupPaymentOverlay();otherTitle();submitDeliveryOptions();if($("table#shopping_bag_table td.assembly").length!=0){assemblyBasket()}basketDeliveryTickboxes();editAddressAction();hiddenSaveCardCheckbox()});(function(a){a.fn.formOverlay=function(c){a.fn.formOverlay.opts=a.extend({},a.fn.formOverlay.defaults,c);a.fn.formOverlay.preloadImages(a.fn.formOverlay.opts.preloadImages);var e=0;var g=a(document).height()+25;var b=a("<div></div>");b.attr("id","formOverlay");b.css({height:g,opacity:0,position:"absolute",top:0,left:e,display:"none",width:"100%"});a(document.body).append(b);var d=a("<div></div>");d.attr("id","overlayMessageCont");var f=a("div#wrapper").offset().top+a("div#checkoutNav").height()+482;d.css({opacity:0,position:"absolute",display:"none"});d.append(a.fn.formOverlay.opts.message);a(document.body).append(d)};a.fn.formOverlay.currentlyActive=false;a.fn.formOverlay.displayOverlay=function(){var d=a("div#formOverlay");var f=a("div#overlayMessageCont");var e=a(window).scrollTop()+((a(window).height()-f.height())/2);var b=(a(window).width()-f.width())/2;d.css({display:"block"}).animate({opacity:a.fn.formOverlay.opts.revealOpacity},a.fn.formOverlay.opts.revealSpeed);f.css({display:"block",top:e,left:b});window.document.body.scroll="no";a("body").css("overflow","hidden");if(a.browser.msie&&a.browser.version==="6.0"){f.before("<iframe id='payment_frame' src='/pws/blank.html' frameBorder='0'></iframe>");var g=f.height();var c=f.width()+50;a("#payment_frame").css({position:"absolute",top:e,left:b,height:g+"px",width:c+"px"});f.animate({opacity:1},a.fn.formOverlay.opts.revealSpeed);f.dropShadow({top:-1,left:-1,blur:5,opacity:0.3});Cufon("h3#overlayHeading")}else{f.animate({opacity:1},a.fn.formOverlay.opts.revealSpeed);f.dropShadow({top:-1,left:-1,blur:5,opacity:0.3});Cufon("h3#overlayHeading")}document.onselectstart=function(){return false};document.onmousedown=function(){return false};if(typeof a.fn.formOverlay.opts.onFormSubmit==="function"){a.fn.formOverlay.opts.onFormSubmit()}};a.fn.formOverlay.preloadImages=function(){for(var b=0;b<arguments.length;b++){a("<img>").attr("src",arguments[b])}};a.fn.formOverlay.opts={};a.fn.formOverlay.defaults={revealSpeed:2000,revealOpacity:0.8,target:this,onFormSubmit:null}})(jQuery);